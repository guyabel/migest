korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
nest(year)
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_by(year) %>%
summarise(i = index_distance(m = . %>% select(orig, dest, flow),
d = . %>% select(orig, dest, dist_cent)))
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_by(year) %>%
summarise(i = index_distance(m = . %>% select(orig, dest, flow),
d = . %>% select(orig, dest, dist_cent),
dist_col = "dist_cent"))
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_by(year) %>%
summarise(i = map2(.x = . %>% select(orig, dest, flow),
.y = . %>% select(orig, dest, dist_cent),
.f = ~index_distance(m = .x, d = .y, dist_col = "dist_cent", long = FALSE)))
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
mutate(year = as.character(year)) %>%
group_by(year) %>%
summarise(i = map2(.x = . %>% select(orig, dest, flow),
.y = . %>% select(orig, dest, dist_cent),
.f = ~index_distance(m = .x, d = .y, dist_col = "dist_cent", long = FALSE)))
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_nest(year)
?group_nest
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_nest(year) %>%
mutate(i = map2(.x = data %>% select(orig, dest, flow),
.y = data %>% select(orig, dest, dist_cent),
.f = ~index_distance(m = .x, d = .y,
dist_col = "dist_cent", long = FALSE)))
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_nest(year) %>%
mutate(i = map2(.x = data, .y = data,
.f = ~index_distance(m = .x, d = .y,
dist_col = "dist_cent", long = FALSE)))
index_distance(
m = subset(korea_gravity, year == 2020)$flow,
d = subset(korea_gravity, year == 2020)$dist_cent
)
subset(korea_gravity, year == 2020)$flow
subset(korea_gravity, year == 2020)$dist_cent
index_distance(
m = subset(korea_gravity, year == 2020)$flow,
d = subset(korea_gravity, year == 2020)$dist_cent
)
index_distance(
m = subset(korea_gravity, year == 2020),
d = subset(korea_gravity, year == 2020)
)
index_distance(
m = subset(korea_gravity, year == 2020),
d = subset(korea_gravity, year == 2020),
dist_col = "dist_cent"
)
m = subset(korea_gravity, year == 2020)
d = subset(korea_gravity, year == 2020)
dist_col = "dist_cent"
orig_col = "orig"; dest_col = "dest"; flow_col = "flow"; pop_col = "pop";
orig <- dest <- flow <- dist <- NULL
ff <- mig_tibble(
m = m, orig_col = orig_col, dest_col = dest_col, flow_col = flow_col
)
ff
d0 <- ff$d
d0
g
g <- ff$g
ff$g
m_reg <- as.character(unique(c(d0$orig, d0$dest)))
d1 <- mig_tibble(m = d, flow_col = "dist")$d
mig_tibble
d1 <- mig_tibble(m = d, flow_col = dist_col)$d
d1
d
d
?mig_tibble
mig_tibble(m = d)
d1 <- mig_tibble(m = d %>% dplyr::select(-flow), flow_col = dist_col)
d1
d1 <- mig_tibble(m = d %>% dplyr::select(-flow), flow_col = dist_col)$d
d1
d1 %>% select(dist)
d1
d0 %>%
dplyr::filter(orig != dest) %>%
dplyr::left_join(d1, by = c("orig", "dest"))
ff$d %>%
dplyr::select(orig, dest, flow)
d %>%
dplyr::select(-flow) %>%
mig_tibble(flow_col = dist_col)$d
d %>%
dplyr::select(-flow)
d %>%
dplyr::select(-flow) %>%
mig_tibble(flow_col = dist_col)
d %>%
dplyr::select(-flow) %>%
mig_tibble(flow_col = dist_col) %>%
.["d"]
d0
d0 <- ff$d %>%
dplyr::select(orig, dest, flow)
d0
d %>%
mig_tibble(flow_col = dist_col)
d1 <- d %>% dplyr::rename(dist := !!dist_col)
d1
d %>%
dplyr::rename(dist := !!dist_col) %>%
mig_tibble()
4d
d
f0 <- mig_tibble(
m = m, orig_col = orig_col, dest_col = dest_col, flow_col = flow_col
)
d0 <- f0$d %>%
dplyr::select(orig, dest, flow)
g <- f0$g
g0 <- f0$g
f1 <- d %>%
dplyr::rename(dist := !!dist_col) %>%
mig_tibble()
orig <- dest <- flow <- dist <- NULL
f0 <- mig_tibble(
m = m, orig_col = orig_col, dest_col = dest_col, flow_col = flow_col
)
d0 <- f0$d %>%
dplyr::select(orig, dest, flow)
g0 <- f0$g
m_reg <- as.character(unique(c(d0$orig, d0$dest)))
# dd <- mig_tibble(m = korea_dist, flow_col = "dist")$d
f1 <- d %>%
dplyr::rename(dist := !!dist_col) %>%
mig_tibble()
d1 <- f1$d %>%
dplyr::select(orig, dest, dist)
g1 <- f1$g
f1 <- d %>%
dplyr::rename(dist := !!dist_col) %>%
mig_tibble(orig_col = orig_col, dest_col = dest_col)
f1
d0 %>%
dplyr::filter(orig != dest) %>%
dplyr::left_join(d1, by = c("orig", "dest"))
index_distance <- function(m = NULL,
d = NULL,
orig_col = "orig", dest_col = "dest",
flow_col = "flow",
dist_col = "dist",
long = TRUE
){
# orig_col = "orig"; dest_col = "dest"; flow_col = "flow"; pop_col = "pop"; dist_col = "dist"
orig <- dest <- flow <- dist <- NULL
f0 <- mig_tibble(
m = m, orig_col = orig_col, dest_col = dest_col, flow_col = flow_col
)
d0 <- f0$d %>%
dplyr::select(orig, dest, flow)
g0 <- f0$g
m_reg <- as.character(unique(c(d0$orig, d0$dest)))
# dd <- mig_tibble(m = korea_dist, flow_col = "dist")$d
f1 <- d %>%
dplyr::rename(dist := !!dist_col) %>%
mig_tibble(orig_col = orig_col, dest_col = dest_col)
d1 <- f1$d %>%
dplyr::select(orig, dest, dist)
g1 <- f1$g
d_reg <- as.character(unique(c(d1$orig, d1$dest)))
if(!setequal(m_reg, d_reg))
stop("different region names in m and d")
# glm(formula = round(flow) ~ orig + dest + log(dist), data = x, family = "poisson")$coefficients["log(dist)"]
d0 %>%
dplyr::filter(orig != dest) %>%
dplyr::left_join(d1, by = c("orig", "dest")) %>%
dplyr::summarise(
mean = matrixStats::weightedMean(x = dist, w = flow),
median = matrixStats::weightedMedian(x = dist, w = flow),
decay = stats::glm(formula = round(flow) ~ orig + dest + log(dist), data = ., family = "poisson")$coefficients["log(dist)"]) %>%
{if(long) tidyr::pivot_longer(data = ., cols = 1:ncol(.), names_to = "measure") else .}
}
index_distance(
m = subset(korea_gravity, year == 2020),
d = subset(korea_gravity, year == 2020),
dist_col = "dist_cent"
)
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_nest(year) %>%
mutate(i = map2(.x = data, .y = data,
.f = ~index_distance(m = .x, d = .y,
dist_col = "dist_cent", long = FALSE)))
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_nest(year) %>%
mutate(i = map2(.x = data, .y = data,
.f = ~index_distance(m = .x, d = .y,
dist_col = "dist_cent", long = FALSE)))
select(-data) %>%
unnest(i)
korea_gravity %>%
select(year, orig, dest, flow, dist_cent) %>%
group_nest(year) %>%
mutate(i = map2(
.x = data, .y = data,
.f = ~index_distance(m = .x, d = .y, dist_col = "dist_cent", long = FALSE)
)) %>%
select(-data) %>%
unnest(i)
library(dplyr)
korea_gravity %>%
filter(year == 2020) %>%
index_connectivity()
korea_gravity %>%
filter(year == 2020)
korea_gravity %>%
filter(year == 2020) %>%
index_connectivity()
d0 <- mig_tibble(m = m, orig_col = orig_col, dest_col = dest_col, flow_col = flow_col)$d
d0
d0 <- mig_tibble(m = m, orig_col = orig_col, dest_col = dest_col, flow_col = flow_col)$d %>%
dplyr::filter(orig != dest) %>%
dplyr::select(orig, dest, flow)
!is.matrix(m)
m <- mig_matrix(m = m, orig_col = orig_col, dest_col = dest_col, flow_col = flow_col)
m %>%
dplyr::as_tibble() %>%
dplyr::rename(orig := !!orig_col,
dest := !!dest_col,
flow := !!flow_col)
m %>%
dplyr::as_tibble() %>%
dplyr::rename(orig := !!orig_col,
dest := !!dest_col,
flow := !!flow_col) %>%
dplyr::relocate(flow, orig, dest)
m <- m %>%
dplyr::as_tibble() %>%
dplyr::rename(orig := !!orig_col,
dest := !!dest_col,
flow := !!flow_col) %>%
dplyr::relocate(flow, orig, dest)
u <- apply(X = m, MARGIN = 2, FUN = dplyr::n_distinct)
u
ii <- which(u == 1)
ii
m <- dplyr::select(m, -dplyr::all_of(names(ii)))
m
m %>%
stats::xtabs(formula = flow ~ orig + dest, data = .)
m %>%
stats::xtabs(formula = flow ~ ., data = .)
m
korea_gravity %>%
filter(year == 2020) %>%
select(orig, dest, flow) %>
korea_gravity %>%
filter(year == 2020) %>%
select(orig, dest, flow) %>%
index_connectivity()
p <- korea_gravity %>%
filter(year == 2020) %>%
distinct(dest, pop)
p <- korea_gravity %>%
filter(year == 2020) %>%
distinct(dest, pop) %>%
pull(pop) %>%
sum()
korea_gravity %>%
filter(year == 2020) %>%
distinct(dest, dest_pop) %>%
pull(dest_pop) %>%
sum()
m <- korea_gravity %>%
filter(year == 2020,
orig != dest) %>%
pull(flow) %>%
sum()
m
p <- korea_gravity %>%
filter(year == 2020) %>%
distinct(dest, dest_pop) %>%
pull(dest_pop) %>%
sum()
p
index_intensity(mig_total = m, pop_total = p/1e6, n = n_distinct(korea_pop$region))
p <- korea_gravity %>%
filter(year == 2020) %>%
distinct(dest, dest_pop)
p
m <- korea_gravity %>%
filter(year == 2020,
orig != dest) %>%
pull(flow) %>%
sum()
m
m
p
sum(p$dest_pop*1e6)
index_intensity(mig_total = m, pop_total = sum(p$dest_pop*1e6), n = nrow(p))
korea_gravity %>%
group_by(year) %>%
summarise(m = sum(flow),
p = sum(dest_pop),
n = n_distinct(dest))
korea_gravity %>%
filter(orig != dest) %>%
group_by(year) %>%
summarise(m = sum(flow))
group_by(year) %>%
pp <- korea_pop %>%
group_by(year) %>%
distinct(dest, dest_pop)
pp <- korea_pop %>%
group_by(year) %>%
distinct(dest, dest_pop)
pp <- korea_pop %>%
distinct(dest, dest_pop) %>%
group_by(year) %>%
summarise(p = sum(dest_pop),
n = n_distinct(dest))
pp <- korea_gravity %>%
distinct(dest, dest_pop) %>%
group_by(year) %>%
summarise(p = sum(dest_pop),
n = n_distinct(dest))
pp <- korea_gravity %>%
group_by(year) %>%
distinct(dest, dest_pop) %>%
summarise(p = sum(dest_pop),
n = n_distinct(dest))
pp
mm %>%
left_join(pp)
mm <- korea_gravity  %>%
filter(orig != dest) %>%
group_by(year) %>%
summarise(m = sum(flow))
mm
mm %>%
left_join(pp) %>%
mutate(i = map2(.x = m, .y = p,
.f = ~index_intensity(mig_total = .x,
pop_total = .y,
n = n_distinct(korea_pop$region),
long = FALSE))) %>%
unnest(cols = i)
?pmap
mm %>%
left_join(pp) %>%
mutate(i = pmap(list(.x = m, .y = p, .z = n),
.f = ~index_intensity(mig_total = .x,
pop_total = .y,
n = .z,
long = FALSE))) %>%
unnest(cols = i)
l <- list(a = x, b = y, c = z)
mm %>%
left_join(pp) %>%
mutate(i = pmap(.l = list(m, p, n),
.f = ~index_intensity(mig_total = ..1,
pop_total = ..3,
n = ..3,
long = FALSE)))
mm %>%
left_join(pp) %>%
mutate(i = pmap(.l = list(m, p, n),
.f = ~index_intensity(mig_total = ..1,
pop_total = ..3,
n = ..3,
long = FALSE))) %>%
unnest(cols = i)
mm %>%
left_join(pp) %>%
mutate(i = pmap(.l = list(m, p, n),
.f = ~index_intensity(mig_total = ..1,
pop_total = ..2,
n = ..3,
long = FALSE))) %>%
unnest(cols = i)
pp <- korea_gravity %>%
group_by(year) %>%
distinct(dest, dest_pop) %>%
summarise(p = sum(dest_pop)*1e6,
n = n_distinct(dest))
mm %>%
left_join(pp) %>%
mutate(i = pmap(
.l = list(m, p, n),
.f = ~index_intensity(mig_total = ..1, pop_total = ..2,n = ..3,
long = FALSE))) %>%
unnest(cols = i)
library(dplyr)
m <- korea_gravity %>%
filter(year == 2020,
orig != dest)
m
m
p <- korea_gravity %>%
filter(year == 2020) %>%
distinct(dest, dest_pop)
p
index_impact(m = m, p = p)
m
m <- korea_gravity %>%
filter(year == 2020,
orig != dest) %>%
select(orig, dest, flow)
m
index_impact(m = m, p = p)
index_impact(m = m, p = p, pop_col = "dest_pop")
index_impact(m = m, p = p, pop_col = "dest_pop", reg_col = "dest")
korea_gravity %>%
select(year, orig, dest, flow, dest_pop) %>%
group_nest(year)
korea_gravity %>%
select(year, orig, dest, flow, dest_pop) %>%
group_nest(year) %>%
mutate(m = data %>%
select(orig, dest, flow),
p = data %>%
distinct(dest, dest_pop))
korea_gravity %>%
select(year, orig, dest, flow, dest_pop) %>%
group_nest(year) %>%
mutate(m = data %>%
select(orig, dest, flow))
korea_gravity %>%
select(year, orig, dest, flow, dest_pop)
korea_gravity %>%
select(year, orig, dest, flow, dest_pop) %>%
group_nest(year) %>%
mutate(m = map(.x = data, .f = ~select(.x, orig, dest, flow)))
korea_gravity %>%
select(year, orig, dest, flow, dest_pop) %>%
group_nest(year) %>%
mutate(m = map(.x = data, .f = ~select(.x, orig, dest, flow)),
m = map(.x = data, .f = ~distinct(.x, dest, dest_pop)))
korea_gravity %>%
select(year, orig, dest, flow, dest_pop) %>%
group_nest(year) %>%
mutate(m = map(.x = data, .f = ~select(.x, orig, dest, flow)),
p = map(.x = data, .f = ~distinct(.x, dest, dest_pop)))
korea_gravity %>%
select(year, orig, dest, flow, dest_pop) %>%
group_nest(year) %>%
mutate(m = map(.x = data, .f = ~select(.x, orig, dest, flow)),
p = map(.x = data, .f = ~distinct(.x, dest, dest_pop)),
i = map2(.x = m, .y = p,
.f = ~index_impact(
m = .x, p = .y, pop_col = "dest_pop", reg_col = "dest", long = FALSE
))) %>%
select(-data, -m, -p) %>%
unnest(i)
roxygen2::roxygenise()
roxygen2::roxygenise()
devtools::check()
pkgdown::build_site(run_dont_run = TRUE)
library(migest)
library(migest)
pkgdown::build_site(run_dont_run = TRUE)
roxygen2::roxygenise()
devtools::build()
roxygen2::roxygenise()
roxygen2::roxygenise()
devtools::check()
devtools::build()
pkgdown::build_site(run_dont_run = TRUE)
usethis::use_github_action("pkgdown")
pkgdown::build_site_github_pages()
pkgdown::build_site_github_pages()
usethis::use_github_action("pkgdown")
pkgdown::build_site_github_pages()
usethis::use_build_ignore(
c("build_package.R", "data-raw", "hex", "old-scripts", "R - copy",
"tests", "LICENSE", "README")
)
roxygen2::roxygenise()
devtools::check()
roxygen2::roxygenise()
devtools::check()
devtools::check()
pkgdown::build_site(run_dont_run = TRUE)
usethis::use_github_action("pkgdown")
roxygen2::roxygenise()
usethis::use_github_action("pkgdown")
pkgdown::build_site(run_dont_run = TRUE)
roxygen2::roxygenise()
devtools::check()
devtools::check()
usethis::use_pkgdown()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
usethis::use_pkgdown()
pkgdown::build_site()
pkgdown::build_site()
usethis::create_package()
usethis::create_package(".")
pkgdown::build_site()
