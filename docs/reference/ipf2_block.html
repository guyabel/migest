<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Iterative proportional fitting routine for the indirect estimation of origin-destination-type migration flow tables with known origin and destination margins and block diagonal elements. — ipf2_block • migest</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Iterative proportional fitting routine for the indirect estimation of origin-destination-type migration flow tables with known origin and destination margins and block diagonal elements. — ipf2_block" />
<meta property="og:description" content="The ipf2.b function finds the maximum likelihood estimates for fitted values in the log-linear model:
$$ \log y_{pq} = \log \alpha_{p} + \log \beta_{q} + \log \lambda_{ij}I(p \in i, q \in j) + \log m_{pq} $$
where \(m_{pq}\) is a prior estimate for \(y_{pq}\) and is no more complex than the matrices being fitted. The \(\lambda_{ij}I(p \in i, q \in j)\) term ensures a saturated fit on the block the \((i,j)\) block." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">migest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/guyabel/migest/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Iterative proportional fitting routine for the indirect estimation of origin-destination-type migration flow tables with known origin and destination margins and block diagonal elements.</h1>
    <small class="dont-index">Source: <a href='https://github.com/guyabel/migest/blob/master/R/ipf2_block.R'><code>R/ipf2_block.R</code></a></small>
    <div class="hidden name"><code>ipf2_block.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>ipf2.b</code> function finds the maximum likelihood estimates for fitted values in the log-linear model:
$$ \log y_{pq} = \log \alpha_{p} + \log \beta_{q} + \log \lambda_{ij}I(p \in i, q \in j) + \log m_{pq} $$
where \(m_{pq}\) is a prior estimate for \(y_{pq}\) and is no more complex than the matrices being fitted. The \(\lambda_{ij}I(p \in i, q \in j)\) term ensures a saturated fit on the block the \((i,j)\) block.</p>
    </div>

    <pre class="usage"><span class='fu'>ipf2_block</span><span class='op'>(</span>
  row_tot <span class='op'>=</span> <span class='cn'>NULL</span>,
  col_tot <span class='op'>=</span> <span class='cn'>NULL</span>,
  block_tot <span class='op'>=</span> <span class='cn'>NULL</span>,
  block <span class='op'>=</span> <span class='cn'>NULL</span>,
  m <span class='op'>=</span> <span class='cn'>NULL</span>,
  tol <span class='op'>=</span> <span class='fl'>1e-05</span>,
  maxit <span class='op'>=</span> <span class='fl'>500</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>row_tot</th>
      <td><p>Vector of origin totals to constrain the sum of the imputed cell rows.</p></td>
    </tr>
    <tr>
      <th>col_tot</th>
      <td><p>Vector of destination totals to constrain the sum of the imputed cell columns.</p></td>
    </tr>
    <tr>
      <th>block_tot</th>
      <td><p>Matrix of block totals to constrain the sum of the imputed cell blocks.</p></td>
    </tr>
    <tr>
      <th>block</th>
      <td><p>Matrix of block structure corresponding to <code>block_tot</code>.</p></td>
    </tr>
    <tr>
      <th>m</th>
      <td><p>Matrix of auxiliary data. By default set to 1 for all origin-destination combinations.</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>Numeric value for the tolerance level used in the parameter estimation.</p></td>
    </tr>
    <tr>
      <th>maxit</th>
      <td><p>Numeric value for the maximum number of iterations used in the parameter estimation.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical value to indicate the print the parameter estimates at each iteration. By default <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passes to <code><a href='block_matrix.html'>block_matrix</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Iterative Proportional Fitting routine set up using the partial likelihood derivatives. The arguments <code>row_tot</code> and <code>col_tot</code> take the row-table and column-table specific known margins. The <code>block_tot</code> take the totals over the blocks in the matrix defined with <code>b</code>. Diagonal values can be added by the user, but care must be taken to ensure resulting diagonals are feasible given the set of margins.</p>
<p>The user must ensure that the row and column totals in each table sum to the same value. Care must also be taken to allow the dimension of the auxiliary matrix (<code>m</code>) equal those provided in the row and column totals.</p>
<p>Returns a <code>list</code> object with</p>
<dt>mu </dt><dd><p>Array of indirect estimates of origin-destination matrices by migrant characteristic</p></dd>
<dt>it </dt><dd><p>Iteration count</p></dd>
<dt>tol </dt><dd><p>Tolerance level at final iteration</p></dd>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='block_matrix.html'>block_matrix</a></code>, <code><a href='stripe_matrix.html'>stripe_matrix</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Guy J. Abel</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'>ipf2_block</span><span class='op'>(</span>row_tot<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>30</span>,<span class='fl'>20</span>,<span class='fl'>30</span>,<span class='fl'>10</span>,<span class='fl'>20</span>,<span class='fl'>5</span>,<span class='fl'>0</span>,<span class='fl'>10</span>,<span class='fl'>5</span>,<span class='fl'>5</span>,<span class='fl'>5</span>,<span class='fl'>10</span><span class='op'>)</span>,
                col_tot <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>45</span>,<span class='fl'>10</span>,<span class='fl'>10</span>,<span class='fl'>5</span>,<span class='fl'>5</span>,<span class='fl'>10</span>,<span class='fl'>50</span>,<span class='fl'>5</span>,<span class='fl'>10</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>,
                block_tot <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span> ,<span class='fl'>50</span>,<span class='fl'>0</span>, <span class='fl'>35</span>,<span class='fl'>0</span>,<span class='fl'>25</span>,<span class='fl'>0</span>, <span class='fl'>10</span>,<span class='fl'>10</span>,<span class='fl'>0</span>,<span class='fl'>0</span>, <span class='fl'>10</span>,<span class='fl'>10</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>,
                              nrow <span class='op'>=</span> <span class='fl'>4</span>, byrow <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
                block <span class='op'>=</span> <span class='fu'><a href='block_matrix.html'>block_matrix</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>16</span>, b <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span>,<span class='fl'>4</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 1 38 
#&gt; 2 3.552714e-15 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/stats/addmargins.html'>addmargins</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>$</span><span class='va'>mu</span><span class='op'>)</span>
</div><div class='output co'>#&gt;            A1         A2    B1    B2    B3         C1        C2        C3
#&gt; A1   0.000000  0.0000000  0.00 0.000 0.000  4.0000000 20.000000 2.0000000
#&gt; A2   0.000000  0.0000000  0.00 0.000 0.000  2.6666667 13.333333 1.3333333
#&gt; B1  14.318182  3.1818182  0.00 0.000 0.000  1.6666667  8.333333 0.8333333
#&gt; B2   4.772727  1.0606061  0.00 0.000 0.000  0.5555556  2.777778 0.2777778
#&gt; B3   9.545455  2.1212121  0.00 0.000 0.000  1.1111111  5.555556 0.5555556
#&gt; C1   2.045455  0.4545455  1.25 0.625 0.625  0.0000000  0.000000 0.0000000
#&gt; C2   0.000000  0.0000000  0.00 0.000 0.000  0.0000000  0.000000 0.0000000
#&gt; C3   4.090909  0.9090909  2.50 1.250 1.250  0.0000000  0.000000 0.0000000
#&gt; C4   2.045455  0.4545455  1.25 0.625 0.625  0.0000000  0.000000 0.0000000
#&gt; D1   2.045455  0.4545455  1.25 0.625 0.625  0.0000000  0.000000 0.0000000
#&gt; D2   2.045455  0.4545455  1.25 0.625 0.625  0.0000000  0.000000 0.0000000
#&gt; D3   4.090909  0.9090909  2.50 1.250 1.250  0.0000000  0.000000 0.0000000
#&gt; Sum 45.000000 10.0000000 10.00 5.000 5.000 10.0000000 50.000000 5.0000000
#&gt;             C4 D1 D2 D3 Sum
#&gt; A1   4.0000000  0  0  0  30
#&gt; A2   2.6666667  0  0  0  20
#&gt; B1   1.6666667  0  0  0  30
#&gt; B2   0.5555556  0  0  0  10
#&gt; B3   1.1111111  0  0  0  20
#&gt; C1   0.0000000  0  0  0   5
#&gt; C2   0.0000000  0  0  0   0
#&gt; C3   0.0000000  0  0  0  10
#&gt; C4   0.0000000  0  0  0   5
#&gt; D1   0.0000000  0  0  0   5
#&gt; D2   0.0000000  0  0  0   5
#&gt; D3   0.0000000  0  0  0  10
#&gt; Sum 10.0000000  0  0  0 150</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Guy J. Abel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


